#include <stdio.h>
#include <stdlib.h>
//#define w 10
#define w 20
#include "AugmentingPath.h"

main(){
// 	int W[w][w] = { 
// 	{  1 ,  0 ,  7 ,  4 ,  9 ,  6 ,  3 ,  9 ,  4 ,  0 },
// 	{  6 ,  4 ,  7 ,  1 ,  6 ,  7 ,  7 ,  6 ,  7 ,  5 },
// 	{  2 ,  7 ,  6 ,  9 ,  6 ,  1 ,  2 ,  2 ,  0 ,  2 },
// 	{  9 ,  0 ,  7 ,  1 ,  5 ,  0 ,  7 ,  4 ,  8 ,  4 },
// 	{  4 ,  1 ,  9 ,  2 ,  0 ,  8 ,  8 ,  8 ,  2 ,  9 },
// 	{  1 ,  4 ,  3 ,  3 ,  3 ,  4 ,  0 ,  3 ,  5 ,  9 },
// 	{  2 ,  6 ,  7 ,  7 ,  0 ,  6 ,  7 ,  8 ,  1 ,  9 },
// 	{  9 ,  2 ,  6 ,  8 ,  1 ,  3 ,  2 ,  1 ,  9 ,  4 },
// 	{  1 ,  1 ,  9 ,  1 ,  8 ,  2 ,  8 ,  1 ,  7 ,  8 },
// 	{  9 ,  0 ,  8 ,  2 ,  7 ,  2 ,  4 ,  5 ,  8 ,  0 } 
// 	};
// 	int W[w][w]={
// 	  {5,2,2,7,0},
// 	  {0,0,0,3,0},
// 	  {1,3,8,0,9},
// 	  {0,1,0,6,1},
// 	  {9,1,0,0,6}
// 	};
	int W[w][w]={{12, 588, 425, 851, 594, 810, 549, 782, 0, 656, 406, 0, 436, 10, 120, 277, 65, 436, 379, 6}, {38, 173, 384, 69, 123, 8, 603, 69, 745, 76, 701, 809, 426, 514, 153, 642, 767, 176, 954, 516}, {84, 102, 791, 17, 780, 203, 0, 493, 934, 764, 0, 905, 168, 3, 16, 78, 1, 743, 962, 22}, {689, 217, 984, 574, 337, 747, 4, 76, 48, 425, 61, 26, 266, 47, 497, 3, 458, 305, 484, 13}, {273, 135, 828, 5, 896, 0, 14, 40, 911, 10, 105, 220, 141, 195, 796, 856, 82, 123, 438, 55}, {236, 56, 1, 267, 530, 588, 344, 166, 55, 439, 512, 187, 303, 106, 93, 200, 48, 214, 303, 89}, {449, 216, 53, 924, 371, 19, 931, 846, 289, 37, 818, 153, 14, 200, 21, 460, 184, 717, 42, 540}, {847, 20, 371, 860, 567, 154, 221, 250, 906, 211, 9, 37, 322, 611, 56, 672, 772, 285, 6, 0}, {0, 800, 379, 36, 411, 278, 32, 511, 554, 631, 278, 424, 262, 398, 123, 434, 265, 146, 316, 66}, {672, 782, 60, 555, 106, 779, 895, 537, 125, 2, 35, 615, 875, 269, 25, 15, 722, 478, 552, 0}, {851, 506, 97, 935, 878, 562, 6, 179, 237, 316, 11, 92, 55, 14, 767, 54, 784, 17, 68, 533}, {75, 2, 165, 90, 990, 86, 689, 0, 158, 44, 374, 424, 473, 844, 118, 16, 905, 457, 66, 293}, {386, 885, 14, 104, 235, 200, 824, 4, 196, 142, 310, 51, 344, 179, 278, 188, 450, 626, 756, 988}, {758, 864, 30, 55, 382, 34, 328, 87, 314, 230, 104, 871, 61, 255, 239, 92, 205, 208, 965, 21}, {647, 949, 230, 308, 664, 260, 0, 747, 159, 928, 412, 4, 77, 0, 622, 379, 707, 283, 50, 359}, {143, 182, 851, 249, 7, 1, 628, 558, 8, 122, 183, 73, 639, 3, 141, 687, 3, 313, 21, 989}, {676, 828, 99, 486, 207, 352, 10, 13, 300, 27, 68, 814, 963, 334, 645, 949, 583, 10, 0, 631}, {285, 287, 404, 232, 311, 964, 611, 462, 439, 510, 204, 530, 893, 10, 6, 253, 529, 0, 409, 984}, {410, 11, 521, 667, 302, 106, 614, 145, 15, 302, 115, 51, 721, 562, 33, 389, 1, 1, 1, 57}, {1, 570, 72, 27, 996, 54, 11, 276, 394, 38, 30, 42, 136, 90, 14, 574, 952, 795, 15, 662}};
	//int * ptrW=&W[0][0];
	int * ptrW=malloc(w*w*sizeof(int));
	int * Q;
 	int i,j;
	int epsilon;
	int setN;
	int v[w]={0};
	int u[w];
	int U;
	int vertexCover=0;
	int Matching=0;
	for(i=0;i<w;i++){
		u[i]=0;
		for(j=0;j<w;j++){
		//	*(ptrW+i*w+j)=W[i][j];//printf("%d ",W[i][j]);
			if(u[i]<W[i][j])
				u[i]=W[i][j];
		}
		for(j=0;j<w;j++){
			*(ptrW+i*w+j)=u[i]-W[i][j];
			//printf("%d ",*(ptrW+i*w+j));
		//	if(u[i]<W[i][j])
		//		u[i]=W[i][j];
		}
		
	}
	do{
		printf("\nu:[");
		for(i=0;i<w;i++)
			printf("%d,",u[i]);
		printf("\nv:[");
		for(i=0;i<w;i++)
			printf("%d,",v[i]);
		
		Q=MaximumMatching(ptrW);
		setN=0;
		printf("\nR:[");
		for(i=0;i<w;i++){

			if(*(Q+i)==1){
				//numQ++;
				//Q[i]=1;
				printf("%d,",i);
				setN++;
			}

		}
		printf("\nT:[ ");
		for(i=w;i<2*w;i++){
					
			if(*(Q+i)==1){
				//numQ++;
				//Q[i+w]=1;
				printf("%d,",i-w);
				setN++;
			}

		}
/*		printf("\n");
		for(i=0;i<2*w;i++)
			printf("%d ",*(Q+i));*/		
		if(setN!=w){
			epsilon=9999999;
			for(i=0;i<w;i++)
				for(j=0;j<w;j++)
					if(*(Q+i)==0&&*(Q+j+w)==0)
						if(*(ptrW+i*w+j)<epsilon)
							epsilon=*(ptrW+i*w+j);
			printf("epsilon=%d\n",epsilon);
			for(i=0;i<w;i++){
				for(j=0;j<w;j++)
					if(*(Q+i)==0&&*(Q+j+w)==0)
						*(ptrW+i*w+j)=*(ptrW+i*w+j)-epsilon;
					else if(*(Q+i)==1&&*(Q+j+w)==1)
						*(ptrW+i*w+j)=*(ptrW+i*w+j)+epsilon;
				if(*(Q+i)==0)
					u[i]=u[i]-epsilon;
				if(*(Q+i+w)==1)
					v[i]=v[i]+epsilon;
			}
			printf("vertex cover:\n");
			for(i=0;i<w;i++){
				printf("%d ",u[i]);
				printf("%d ",v[i]);
			}
		}
		else{
			printf("perfect matching found.\n");
			for(i=0;i<w;i++){
				vertexCover=vertexCover+u[i]+v[i];
				Matching=Matching+W[i][*(Q+2*w+i)];
				printf("(%d, %d)",i,*(Q+2*w+i));
			}
			if(vertexCover!=Matching){
				printf("Vertex cover doesn't match mathching!\n");
;

				exit(1);
			}
			else
				printf("Matching: %d= Vertex Cover: %d\n",Matching, vertexCover);
		}
// 		for(i=0;i<2*w;i++)
// 			printf("%d ",*(Q+i));
		
	}while(setN!=w);
	free(ptrW);
}
